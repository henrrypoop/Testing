#A script used to check for player activity after a certain amount of time,relies on minecraft latest.log
#Unfinished.
#!/bin/bash

#Function to send list command to server
sendlist(){
> $PWD/logs/latest.log #clear the log file.
#Send the command 'list' to the console to check for player count.
screen -S TESTING -X eval 'stuff "list"\015'
sleep 4 #wait 4 seconds before sending another command

}


while true;do 
    sendlist
  		#check the log file whether there are players or not.
if grep -q "are 0" logs/latest.log;then # grep -q outputs an exit code,true if ran successfull
 
   > $PWD/logs/latest.log

	 screen -S TESTING -X eval 'stuff "say Server is shutting down in 5 seconds soon due to inactivity..."\015'
	 sleep 5
   screen -S TESTING -X eval 'stuff "say Performing one final player check..."\015'
   sleep 2
   
   sendlist
   
   if grep -q "are 0" logs/latest.log;then
   > $PWD/logs/latest.log #clear the log file.
   	#Send the command 'stop' to the console to stop the server.
   screen -S TESTING -X eval 'stuff "say Server is shutting down..."\015'
   screen -S TESTING -X eval 'stuff "stop"\015'
   break
   else
   screen -S TESTING -X eval 'stuff "say Shutdown halted: Player detected"\015'
   fi
fi
sleep 4 #sleep is basically wait for... 
done
