
#!/bin/bash

#Function to send list command to server
sendlist(){
> $PWD/logs/latest.log #clear the log file.
#Send the command 'list' to the console to check for player count.
screen -S MCserver -X eval 'stuff "list"\015'
sleep 3 #wait 3 seconds before sending another command

}

sleep 300 #Wait 5 minutes for the server to start >>
while true;do
    sendlist
                #check the log file whether there are players or not.
if grep -q "are 0" logs/latest.log;then # grep -q outputs an exit code,true if ran successfull
   sleep 10 #Wait another 10 seconds to see whether a player would join or not.

   sendlist

   if grep -q "are 0" logs/latest.log;then

        #Send the command 'stop' to the console to stop the server.
    screen -S MCserver -X eval 'stuff "say Server is shutting down..."\015'
    screen -S MCserver -X eval 'stuff "stop"\015'
    sleep 10 #Wait for the server to fully shutdown
    sudo shutdown -h now #Then shut down the system
   else
   screen -S MCserver -X eval 'stuff "say Shutdown halted: Player detected"\015'
   fi
fi
sleep 1200 #sleep is basically wait for... (In this case: 20 minutes)
done




