#!/bin/bash

#Function to send list command to server
sendlist(){
> $PWD/logs/latest.log #clear the log file.
#Send the command 'list' to the console to check for player count.
screen -S TESTING -X eval 'stuff "list"\015'
sleep 3 #wait 3 seconds before sending another command

}


while true;do 
    sendlist
  		#check the log file whether there are players or not.
if grep -q "are 0" logs/latest.log;then # grep -q outputs an exit code,true if ran successfull
   sleep 10 # Wait another 10 seconds to see whether a player joins or not...
   sendlist
   
   if grep -q "are 0" logs/latest.log;then

   	#Send the command 'stop' to the console to stop the server.
    screen -S TESTING -X eval 'stuff "say Server is shutting down..."\015'
    screen -S TESTING -X eval 'stuff "stop"\015'
    break
   else
   screen -S TESTING -X eval 'stuff "say Shutdown halted: Player detected"\015'
   fi
fi
sleep 4 #sleep is basically wait for... 
done
